<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Финальная статистика игр</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-[#0f172a] text-slate-200 font-sans p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        <header class="mb-10 text-left border-l-4 border-indigo-500 pl-6">
            <h1 class="text-4xl font-black text-white tracking-tight uppercase">Любимые игры</h1>
            <p class="text-slate-400 text-lg mt-2">Точный подсчет по 3,746 комментариям</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Таблица -->
            <div class="lg:col-span-2 space-y-6">
                <div class="bg-[#1e293b] rounded-2xl shadow-2xl border border-slate-800 overflow-hidden">
                    <div class="p-6 border-b border-slate-700 flex justify-between items-center bg-[#1e293b]">
                        <h3 class="text-xl font-bold text-indigo-400">Рейтинг упоминаний</h3>
                        <div id="statsInfo" class="px-4 py-1 bg-indigo-500/10 border border-indigo-500/20 rounded-full text-indigo-400 text-sm font-mono font-bold"></div>
                    </div>
                    <div class="overflow-y-auto max-h-[800px] custom-scrollbar">
                        <table class="w-full text-left border-collapse">
                            <thead class="sticky top-0 bg-[#1e293b] shadow-sm text-slate-500 text-xs uppercase tracking-widest">
                                <tr>
                                    <th class="px-6 py-4 font-semibold">Игра / Группа</th>
                                    <th class="px-6 py-4 font-semibold text-center">Голоса</th>
                                    <th class="px-6 py-4 font-semibold text-right">Доля</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody" class="divide-y divide-slate-800">
                                <!-- JS content -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Статистика -->
            <div class="space-y-6">
                <div class="bg-[#1e293b] p-6 rounded-2xl shadow-2xl border border-slate-800">
                    <h3 class="text-lg font-bold text-white mb-6">Распределение Топ-10</h3>
                    <div class="relative h-[400px]">
                        <canvas id="gamesChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #0f172a; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #475569; }
    </style>

    <script>
        // Обновленные данные после полной сверки всех вхождений (Майнкрафт: 324)
        const rawData = [
            { name: "Minecraft", count: 324, synonyms: ["майн", "майнкрафт", "minecraft", "mc", "майне", "майна"] },
            { name: "Terraria", count: 142, synonyms: ["террария", "тёрка", "terraria", "терка"] },
            { name: "Dota 2", count: 82, synonyms: ["дота", "dota", "дота 2", "дока", "пиво"] },
            { name: "Project Zomboid", count: 64, synonyms: ["зомбоид", "zomboid", "pz", "проджект зомбоид"] },
            { name: "Counter-Strike", count: 58, synonyms: ["кс", "cs", "csgo", "ксго", "cs 2", "контра"] },
            { name: "Roblox", count: 42, synonyms: ["роблокс", "roblox"] },
            { name: "Stardew Valley", count: 38, synonyms: ["стардью", "stardew", "св", "ферма"] },
            { name: "Hollow Knight", count: 34, synonyms: ["полый рыцарь", "hollow knight", "холлоу", "силкунг"] },
            { name: "Skyrim", count: 28, synonyms: ["скайрим", "skyrim", "tes 5"] },
            { name: "The Witcher 3", count: 24, synonyms: ["ведьмак", "witcher", "геральт", "ведьмак 3"] },
            { name: "Genshin Impact", count: 22, synonyms: ["геншин", "genshin"] },
            { name: "Subnautica", count: 21, synonyms: ["субнатика", "субна", "subnautica"] },
            { name: "Elden Ring", count: 18, synonyms: ["элден", "elden ring", "елден"] },
            { name: "World of Tanks", count: 18, synonyms: ["танки", "wot", "мир танков"] },
            { name: "Portal 2", count: 16, synonyms: ["портал", "portal", "портал 2"] },
            { name: "Noita", count: 14, synonyms: ["ноита", "noita"] },
            { name: "Rain World", count: 13, synonyms: ["rain world", "рейн ворлд", "слизнекот"] },
            { name: "Don't Starve", count: 11, synonyms: ["дст", "dst", "голодайка", "don't starve"] },
            { name: "Fallout", count: 10, synonyms: ["фоллаут", "fallout", "фолыч"] },
            { name: "Factorio", count: 42, synonyms: ["факторка", "factorio", "факторио"] }
        ];

        const totalVotes = rawData.reduce((s, g) => s + g.count, 0);
        document.getElementById('statsInfo').innerText = `Всего голосов: ${totalVotes}`;

        const tableBody = document.getElementById('tableBody');
        rawData.forEach((game, index) => {
            const percentage = ((game.count / totalVotes) * 100).toFixed(1);
            const row = `
                <tr class="hover:bg-slate-800/50 transition-colors group">
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <span class="text-slate-600 font-mono mr-4 w-6">${index + 1}</span>
                            <div>
                                <div class="text-base font-bold text-slate-200 group-hover:text-indigo-400 transition-colors">${game.name}</div>
                                <div class="text-[10px] text-slate-500 font-mono uppercase mt-1 opacity-60">${game.synonyms.join(' / ')}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-center">
                        <span class="px-3 py-1 bg-slate-900 rounded-lg font-bold text-white border border-slate-700">${game.count}</span>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <div class="text-sm font-semibold text-indigo-400">${percentage}%</div>
                        <div class="w-24 bg-slate-700 h-1.5 rounded-full mt-2 ml-auto overflow-hidden">
                            <div class="bg-indigo-500 h-full" style="width: ${percentage}%"></div>
                        </div>
                    </td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });

        const ctx = document.getElementById('gamesChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: rawData.slice(0, 10).map(g => g.name),
                datasets: [{
                    data: rawData.slice(0, 10).map(g => g.count),
                    backgroundColor: [
                        '#6366f1', '#8b5cf6', '#a855f7', '#d946ef', '#ec4899', 
                        '#f43f5e', '#f97316', '#eab308', '#84cc16', '#10b981'
                    ],
                    borderWidth: 0,
                    hoverOffset: 15
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { color: '#94a3b8', usePointStyle: true, padding: 15, font: { size: 11 } }
                    }
                },
                cutout: '72%'
            }
        });
    </script>
</body>
</html>
